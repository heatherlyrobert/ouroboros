#!/usr/local/bin/koios
#   koios-polos (north star) -- customized c unit testing meta-program and mini-language



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
PREP          include the prototype headers                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include public header                ouroboros.h                 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
SCRP          (TEST) verify calling and gathering unit tests                     TEST_run, TEST_read                                                                                   ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       initialize the global data                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     start testing                        PROG__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     local    create working variable              - - - - - - - - - - - - -   tWAVE    *x_wave  = NULL;                                                                                                                                                                                                  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.urun");                                                                                                                                                                                          
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.wave");                                                                                                                                                                                          
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_scrp.wave");                                                                                                                                                                                     
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_prog.wave");                                                                                                                                                                                     

   COND       add a first file                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ÿ § 7 § koios §  1 § sample script¶         > /tmp/koios.wave                                                                                                                                                       
     system   add a line                           - - - - - - - - - - - - -   echo  ¶è § 2 § koios §  2 § other script¶         >> /tmp/koios.wave                                                                                                                                                       
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ë § 5 § koios §  3 § another sample¶       >> /tmp/koios.wave                                                                                                                                                       

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     inventory directory                  WAVE_inventory              "/tmp"                  , 'y'                                                                         i_equal     1                                                                                                    
     echo     ... review count                     - - - - - - - - - - - - -   my.scrps                                                                                              i_equal     3                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : è  2   5[koios]                  2  12[other script]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : ë  5   5[koios]                  3  14[another sample]                            
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : ÿ  7   5[koios]                  1  13[sample script]                             
     get      ... check entry                      WAVE__unit                  "entry"        ,  3                                                                                   s_equal     WAVE entry  ( 3) : -  -   -[]                       -   -[]                                          

   COND       place the result                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶SCRP [02] (WAVE) verify allocating and freeing script entries ===========[è1]=[00015]¶                   > /tmp/koios.urun
     system   add a line                           - - - - - - - - - - - - -   echo  BACK_GRN ¶PRCS -------- cond=13    test=50    [ pass=50    fail=0     badd=0     void=0     ]¶ BACK_OFF  >> /tmp/koios.urun

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 0                                                                           i_equal     0                                                                                                    
     exec     check result                         TEST_result                 x_wave                                                                                                i_equal     0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       attempt non-existant result                                        - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.urun");                                                                                                                                                                                          

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 1                                                                           i_equal     0                                                                                                    
     exec     check result                         TEST_result                 x_wave                                                                                                i_lesser    0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       attempt empty result                                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     touch the file                       - - - - - - - - - - - - -   system ("touch /tmp/koios.urun");                                                                                                                                                                                          

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 1                                                                           i_equal     0                                                                                                    
     exec     check result                         TEST_result                 x_wave                                                                                                i_lesser    0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       attempt single line result                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶SCRP [02] (WAVE) verify allocating and freeing script entries ===========[è1]=[00015]¶                   > /tmp/koios.urun

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 1                                                                           i_equal     0                                                                                                    
     exec     check result                         TEST_result                 x_wave                                                                                                i_lesser    0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       place a second result                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶SCRP [03] (WAVE) verify allocating and freeing script entries ===========[è1]=[00015]¶                   > /tmp/koios.urun
     system   add a line                           - - - - - - - - - - - - -   echo  BACK_GRN ¶PRCS -------- cond=3     test=27    [ pass=20    fail=5     badd=2     void=0     ]¶ BACK_OFF  >> /tmp/koios.urun

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 1                                                                           i_equal     0                                                                                                    
     exec     check result                         TEST_result                 x_wave                                                                                                i_equal     0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 1     3c,    27t,    20p,     5f,     2b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       place a second result                                              - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶SCRP [01] (WAVE) verify allocating and freeing script entries ===========[è1]=[00015]¶                   > /tmp/koios.urun
     system   add a line                           - - - - - - - - - - - - -   echo  BACK_GRN ¶PRCS -------- cond=160   test=205   [ pass=200   fail=0     badd=5     void=0     ]¶ BACK_OFF  >> /tmp/koios.urun

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 2                                                                           i_equal     0                                                                                                    
     exec     check result                         TEST_result                 x_wave                                                                                                i_equal     0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 1     3c,    27t,    20p,     5f,     2b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 2   160c,   205t,   200p,     0f,     5b,     0v                                  

   COND       complete testing                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.urun");                                                                                                                                                                                          
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.wave");                                                                                                                                                                                          
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_scrp.wave");                                                                                                                                                                                     
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_prog.wave");                                                                                                                                                                                     
     exec     stop testing                         PROG__unit_end                                                                                                                    i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
SCRP          (TEST) verify calling and gathering unit tests                     TEST_run, TEST_read                                                                                   ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       initialize the global data                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     start testing                        PROG__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     local    create working variable              - - - - - - - - - - - - -   tWAVE    *x_wave  = NULL;                                                                                                                                                                                                  
     code     create testbed directory             - - - - - - - - - - - - -   system ("mkdir testbed");                                                                                                                                                                                     
     code     copy fake unit test                  - - - - - - - - - - - - -   system ("cp koios_unit testbed/koios_unit");                                                                                                                                                                                
     code     move in                              - - - - - - - - - - - - -   chdir  ("testbed");                                                                                                                                                                                     
     code     make executable                      - - - - - - - - - - - - -   system ("chmod +x koios_unit");                                                                                                                                                                                

   COND       add a first file                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ÿ § 7 § koios §  1 § sample script¶         > koios.wave                                                                                                                                                       
     system   add a line                           - - - - - - - - - - - - -   echo  ¶è § 2 § koios §  2 § other script¶         >> koios.wave                                                                                                                                                       
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ë § 5 § koios §  3 § another sample¶       >> koios.wave                                                                                                                                                       

   COND       run with one file filled                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     inventory directory                  WAVE_here                                                                                                                         i_equal     1                                                                                                    
     echo     ... review path                      - - - - - - - - - - - - -   my.path                                                                                               s_equal     /home/system/ouroboros.master_test_sequencer/testbed                                                 
     echo     ... review count                     - - - - - - - - - - - - -   my.scrps                                                                                              i_equal     3                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : è  2   5[koios]                  2  12[other script]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : ë  5   5[koios]                  3  14[another sample]                            
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : ÿ  7   5[koios]                  1  13[sample script]                             
     get      ... check entry                      WAVE__unit                  "entry"        ,  3                                                                                   s_equal     WAVE entry  ( 3) : -  -   -[]                       -   -[]                                          

   COND       run unit test for first                                            - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 0                                                                           i_equal     0                                                                                                    
     exec     run tunit test                       TEST_run                    x_wave                                                                                                i_equal     0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       run unit test for second                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 1                                                                           i_equal     0                                                                                                    
     exec     run tunit test                       TEST_run                    x_wave                                                                                                i_equal     0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 1     3c,    27t,    20p,     5f,     2b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 0     0c,     0t,     0p,     0f,     0b,     0v                                  

   COND       run unit test for third                                            - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     ... get first                        WAVE_by_index               &x_wave                 , 2                                                                           i_equal     0                                                                                                    
     exec     run tunit test                       TEST_run                    x_wave                                                                                                i_equal     0                                                                                                    
     get      ... check urun                       TEST__unit                  "urun"         ,  0                                                                                   s_equal     TEST urun   ( 0) : 0    13c,    50t,    50p,     0f,     0b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  1                                                                                   s_equal     TEST urun   ( 1) : 1     3c,    27t,    20p,     5f,     2b,     0v                                  
     get      ... check urun                       TEST__unit                  "urun"         ,  2                                                                                   s_equal     TEST urun   ( 2) : 2   160c,   205t,   200p,     0f,     5b,     0v                                  

   COND       complete testing                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     create testbed directory             - - - - - - - - - - - - -   chdir  ("/home/system/ouroboros.master_test_sequencer");                                                                                                                                                                                                
     code     create testbed directory             - - - - - - - - - - - - -   system ("rm -rf testbed");                                                                                                                                                                                     
     exec     stop testing                         PROG__unit_end                                                                                                                    i_equal     0                                                                                                    



