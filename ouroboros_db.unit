#!/usr/local/bin/koios
#   koios-polos (axis of heaven) unit testing meta-language



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
PREP          include the prototype headers                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include public header                ouroboros.h                 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
SCRP    [è1]  (DB) verify openning and closing database                          DB__open, DB__close                                                                                   ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       initialize the global data                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     start testing                        PROG__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     code     create working variable              - - - - - - - - - - - - -   int        x_projs;                                                                                                                                                                                                        
     code     create working variable              - - - - - - - - - - - - -   int        x_units;                                                                                                                                                                                                        
     code     create working variable              - - - - - - - - - - - - -   int        x_scrps;                                                                                                                                                                                                        
     code     create working variable              - - - - - - - - - - - - -   int        x_conds;                                                                                                                                                                                                        
     code     create working variable              - - - - - - - - - - - - -   int        x_steps;                                                                                                                                                                                                        
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/testing.db");                                                                                                                                                                                          

   COND       set an alternative database name                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     create working variable              - - - - - - - - - - - - -   char       *x_args [3]  = { "ouroboros"      , "--db"           , "/tmp/testing"   };                                                                                                                                      
     exec     call arg                             PROG__args                  3              , x_args                                                                               i_equal     0                                                                                                    
     echo     ... review database name             - - - - - - - - - - - - -   my.n_db                                                                                               s_equal     /tmp/testing.db                                                                                      

   COND       attempt to close when not already open                             - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    
     exec     call database close                  DB__close                                                                                                                         i_lesser    0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       attempt to read a non-existant file                                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call database open                   DB__open                    'r'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_lesser    0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       attempt to read a empty file                                       - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     syst     touch a file                         - - - - - - - - - - - - -   touch  /tmp/testing.db                                                                                                                                                                                                     
     exec     call database open                   DB__open                    'r'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_lesser    0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       write a header-only file                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     ... update global                    - - - - - - - - - - - - -   x_projs  = 2;                                                                                                                                                                                                              
     code     ... update global                    - - - - - - - - - - - - -   x_units  = 11;                                                                                                                                                                                                             
     code     ... update global                    - - - - - - - - - - - - -   x_scrps  = 44;                                                                                                                                                                                                             
     code     ... update global                    - - - - - - - - - - - - -   x_conds  = 123;                                                                                                                                                                                                            
     code     ... update global                    - - - - - - - - - - - - -   x_steps  = 515;                                                                                                                                                                                                            
     exec     call database open                   DB__open                    'w'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_exists    0                                                                                                    
     exec     call database close                  DB__close                                                                                                                         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       read the header                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.007))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     ... clear globals                    - - - - - - - - - - - - -   x_projs = x_units = x_scrps = x_conds = x_steps = 0;                                                                                                                                                                       
     exec     call database open                   DB__open                    'r'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_exists    0                                                                                                    
     echo     ... review project count             - - - - - - - - - - - - -   x_projs                                                                                               i_equal     2                                                                                                    
     echo     ... review unit count                - - - - - - - - - - - - -   x_units                                                                                               i_equal     11                                                                                                   
     echo     ... review script count              - - - - - - - - - - - - -   x_scrps                                                                                               i_equal     44                                                                                                   
     echo     ... review condition count           - - - - - - - - - - - - -   x_conds                                                                                               i_equal     123                                                                                                  
     echo     ... review test step count           - - - - - - - - - - - - -   x_steps                                                                                               i_equal     515                                                                                                  
     exec     call database close                  DB__close                                                                                                                         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       complete testing                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.008))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/testing.db");                                                                                                                                                                                          
     exec     stop testing                         PROG__unit_end                                                                                                                    i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  -  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  t  ========(var)======= 
SCRP    [è1]  (DB) verify writing and reading database                           DB_write, DB_read                                                                                     ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       initialize the global data                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     start testing                        PROG__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     code     create working variable              - - - - - - - - - - - - -   tWAVE    *x_wave  = NULL;                                                                                                                                                                                                  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.wave");                                                                                                                                                                                          
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_scrp.wave");                                                                                                                                                                                     
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_prog.wave");                                                                                                                                                                                     

   COND       set an alternative database name                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     create working variable              - - - - - - - - - - - - -   char       *x_args [3]  = { "ouroboros"      , "--db"           , "/tmp/testing"   };                                                                                                                                      
     exec     call arg                             PROG__args                  3              , x_args                                                                               i_equal     0                                                                                                    
     echo     ... review database name             - - - - - - - - - - - - -   my.n_db                                                                                               s_equal     /tmp/testing.db                                                                                      

   COND       add a first file                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ÿ § 7 § koios      § 11 § sample script¶         > /tmp/koios.wave                                                                                                                                                       
     system   add a line                           - - - - - - - - - - - - -   echo  ¶è § 2 § koios      §  2 § other script¶         >> /tmp/koios.wave                                                                                                                                                       
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ë § 5 § koios      §  5 § another sample¶       >> /tmp/koios.wave                                                                                                                                                       

   COND       add a second file                                                  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ê § 7 § koios_scrp §  1 § good one¶              > /tmp/koios_scrp.wave                                                                                                                                                  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ê § 8 § koios_scrp §  2 § fantastic¶            >> /tmp/koios_scrp.wave                                                                                                                                                  

   COND       add third file                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶ò § 2 § koios_prog §  1 § middlish¶              > /tmp/koios_prog.wave                                                                                                                                                  
     system   add a line                           - - - - - - - - - - - - -   echo  ¶õ § 1 § koios_prog §  2 § little later¶         >> /tmp/koios_prog.wave                                                                                                                                                  

   COND       run with three files                                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     inventory directory                  WAVE_inventory              "/tmp"                  , 'y'                                                                         i_equal     3                                                                                                    
     echo     ... review count                     - - - - - - - - - - - - -   my.scrps                                                                                              i_equal     7                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : è  2   5[koios]                  2  12[other script]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : ê  7  10[koios_scrp]             1   8[good one]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : ê  8  10[koios_scrp]             2   9[fantastic]                                 
     get      ... check entry                      WAVE__unit                  "entry"        ,  3                                                                                   s_equal     WAVE entry  ( 3) : ë  5   5[koios]                  5  14[another sample]                            
     get      ... check entry                      WAVE__unit                  "entry"        ,  4                                                                                   s_equal     WAVE entry  ( 4) : ò  2  10[koios_prog]             1   8[middlish]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  5                                                                                   s_equal     WAVE entry  ( 5) : õ  1  10[koios_prog]             2  12[little later]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  6                                                                                   s_equal     WAVE entry  ( 6) : ÿ  7   5[koios]                 11  13[sample script]                             
     get      ... overall statistics               DB__unit                    "stats"        ,  0                                                                                   s_equal     DB stats         :     1p,     3u,     7s,     0c,     0s        0r,     0p,     0f,     0b,     0o  

   COND       write database                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call writing                         DB_write                                                                                                                          i_equal     7                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       purge all data                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     run purge                            WAVE_purge                                                                                                                        i_equal     0                                                                                                    
     echo     ... review count                     - - - - - - - - - - - - -   my.scrps                                                                                              i_equal     0                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  4                                                                                   s_equal     WAVE entry  ( 4) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  5                                                                                   s_equal     WAVE entry  ( 5) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  6                                                                                   s_equal     WAVE entry  ( 6) : -  -   -[]                       -   -[]                                          

   COND       read database                                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call reading                         DB_read                                                                                                                           i_equal     7                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : è  2   5[koios]                  2  12[other script]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : ê  7  10[koios_scrp]             1   8[good one]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : ê  8  10[koios_scrp]             2   9[fantastic]                                 
     get      ... check entry                      WAVE__unit                  "entry"        ,  3                                                                                   s_equal     WAVE entry  ( 3) : ë  5   5[koios]                  5  14[another sample]                            
     get      ... check entry                      WAVE__unit                  "entry"        ,  4                                                                                   s_equal     WAVE entry  ( 4) : ò  2  10[koios_prog]             1   8[middlish]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  5                                                                                   s_equal     WAVE entry  ( 5) : õ  1  10[koios_prog]             2  12[little later]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  6                                                                                   s_equal     WAVE entry  ( 6) : ÿ  7   5[koios]                 11  13[sample script]                             



   COND       complete testing                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.008))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/testing.db");                                                                                                                                                                                          
     exec     stop testing                         PROG__unit_end                                                                                                                    i_equal     0                                                                                                    



# end-of-file.  done, finito, completare, whimper [Ï´···
