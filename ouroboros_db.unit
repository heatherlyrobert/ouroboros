#!/usr/local/bin/koios
#   koios-polos (axis of heaven) unit testing meta-language



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
PREP          include the prototype headers                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
   incl       include public header                ouroboros.h                 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   - - - - -   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP          (DB) verify openning and closing database                           0s  access          DB__open, DB__close                                                          ((01.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       initialize the global data                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     start testing                        PROG__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     local    create working variable              - - - - - - - - - - - - -   int        x_projs;                                                                                                                                                                                                        
     local    create working variable              - - - - - - - - - - - - -   int        x_units;                                                                                                                                                                                                        
     local    create working variable              - - - - - - - - - - - - -   int        x_scrps;                                                                                                                                                                                                        
     local    create working variable              - - - - - - - - - - - - -   int        x_conds;                                                                                                                                                                                                        
     local    create working variable              - - - - - - - - - - - - -   int        x_steps;                                                                                                                                                                                                        
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/testing.db");                                                                                                                                                                                          

   COND       set an alternative database name                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     local    create working variable              - - - - - - - - - - - - -   char       *x_args [3]  = { "ouroboros"      , "--db"           , "/tmp/testing"   };                                                                                                                                      
     exec     call arg                             PROG__args                  3              , x_args                                                                               i_equal     0                                                                                                    
     echo     ... review database name             - - - - - - - - - - - - -   my.n_db                                                                                               s_equal     /tmp/testing.db                                                                                      

   COND       attempt to close when not already open                             - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    
     exec     call database close                  DB__close                                                                                                                         i_lesser    0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       attempt to read a non-existant file                                - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call database open                   DB__open                    'r'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_lesser    0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       attempt to read a empty file                                       - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   touch a file                         - - - - - - - - - - - - -   touch  /tmp/testing.db                                                                                                                                                                                                     
     exec     call database open                   DB__open                    'r'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_lesser    0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       write a header-only file                                           - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     ... update global                    - - - - - - - - - - - - -   x_projs  = 2;                                                                                                                                                                                                              
     code     ... update global                    - - - - - - - - - - - - -   x_units  = 11;                                                                                                                                                                                                             
     code     ... update global                    - - - - - - - - - - - - -   x_scrps  = 44;                                                                                                                                                                                                             
     code     ... update global                    - - - - - - - - - - - - -   x_conds  = 123;                                                                                                                                                                                                            
     code     ... update global                    - - - - - - - - - - - - -   x_steps  = 515;                                                                                                                                                                                                            
     exec     call database open                   DB__open                    'w'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_exists    0                                                                                                    
     exec     call database close                  DB__close                                                                                                                         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       read the header                                                    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.007))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     ... clear globals                    - - - - - - - - - - - - -   x_projs = x_units = x_scrps = x_conds = x_steps = 0;                                                                                                                                                                       
     exec     call database open                   DB__open                    'r'            , &x_projs       , &x_units       , &x_scrps       , &x_conds       , &x_steps         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_exists    0                                                                                                    
     echo     ... review project count             - - - - - - - - - - - - -   x_projs                                                                                               i_equal     2                                                                                                    
     echo     ... review unit count                - - - - - - - - - - - - -   x_units                                                                                               i_equal     11                                                                                                   
     echo     ... review script count              - - - - - - - - - - - - -   x_scrps                                                                                               i_equal     44                                                                                                   
     echo     ... review condition count           - - - - - - - - - - - - -   x_conds                                                                                               i_equal     123                                                                                                  
     echo     ... review test step count           - - - - - - - - - - - - -   x_steps                                                                                               i_equal     515                                                                                                  
     exec     call database close                  DB__close                                                                                                                         i_equal     0                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       complete testing                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((01.008))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/testing.db");                                                                                                                                                                                          
     exec     stop testing                         PROG__unit_end                                                                                                                    i_equal     0                                                                                                    



#23456789-12  123456789-123456789-123456789-12345  123456789-123456789-123456  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-  123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-123456789-  123456789-123456789- 
#==(verb)===  ===========(description)===========  =====(function)===========  ========================(arguments)=================================================================  ==(test)==  ==========================(results)=================================================================  ========(var)======= 
SCRP          (DB) verify writing and reading database                            0s  read            DB_write, DB_read                                                            ((02.---))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  

   COND       initialize the global data                                         - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.001))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     start testing                        PROG__unit_quiet                                                                                                                  i_equal     0                                                                                                    
     local    create working variable              - - - - - - - - - - - - -   tWAVE    *x_wave  = NULL;                                                                                                                                                                                                  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios.wave");                                                                                                                                                                                          
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_scrp.wave");                                                                                                                                                                                     
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/koios_prog.wave");                                                                                                                                                                                     

   COND       set an alternative database name                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.002))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     local    create working variable              - - - - - - - - - - - - -   char       *x_args [3]  = { "ouroboros"      , "--db"           , "/tmp/testing"   };                                                                                                                                      
     exec     call arg                             PROG__args                  3              , x_args                                                                               i_equal     0                                                                                                    
     echo     ... review database name             - - - - - - - - - - - - -   my.n_db                                                                                               s_equal     /tmp/testing.db                                                                                      

   COND       add a first file                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.003))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  \"  Д 7 Д koios      Д 11 Д sample script\"         > /tmp/koios.wave                                                                                                                                                
     system   add a line                           - - - - - - - - - - - - -   echo  \"У Д 2 Д koios      Д  2 Д other script\"         >> /tmp/koios.wave                                                                                                                                                
     system   add a line                           - - - - - - - - - - - - -   echo  \"в Д 5 Д koios      Д  5 Д another sample\"       >> /tmp/koios.wave                                                                                                                                                

   COND       add a second file                                                  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.004))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  \"Ж Д 7 Д koios_scrp Д  1 Д good one\"              > /tmp/koios_scrp.wave                                                                                                                                           
     system   add a line                           - - - - - - - - - - - - -   echo  \"Ж Д 8 Д koios_scrp Д  2 Д fantastic\"            >> /tmp/koios_scrp.wave                                                                                                                                           

   COND       add third file                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.005))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     system   add a line                           - - - - - - - - - - - - -   echo  \"Ы Д 2 Д koios_prog Д  1 Д middlish\"              > /tmp/koios_prog.wave                                                                                                                                           
     system   add a line                           - - - - - - - - - - - - -   echo  \"ш Д 1 Д koios_prog Д  2 Д little later\"         >> /tmp/koios_prog.wave                                                                                                                                           

   COND       run with three files                                               - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.006))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     inventory directory                  WAVE_inventory              "/tmp"                  , 'y'                                                                         i_equal     3                                                                                                    
     echo     ... review count                     - - - - - - - - - - - - -   my.scrps                                                                                              i_equal     7                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : У  2   5[koios]                  2  12[other script]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : Ж  7  10[koios_scrp]             1   8[good one]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : Ж  8  10[koios_scrp]             2   9[fantastic]                                 
     get      ... check entry                      WAVE__unit                  "entry"        ,  3                                                                                   s_equal     WAVE entry  ( 3) : в  5   5[koios]                  5  14[another sample]                            
     get      ... check entry                      WAVE__unit                  "entry"        ,  4                                                                                   s_equal     WAVE entry  ( 4) : Ы  2  10[koios_prog]             1   8[middlish]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  5                                                                                   s_equal     WAVE entry  ( 5) : ш  1  10[koios_prog]             2  12[little later]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  6                                                                                   s_equal     WAVE entry  ( 6) :    7   5[koios]                 11  13[sample script]                             
     get      ... overall statistics               DB__unit                    "stats"        ,  0                                                                                   s_equal     DB stats         :     1p,     3u,     7s,     0c,     0s        0r,     0p,     0f,     0b,     0o  

   COND       write database                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.007))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call writing                         DB_write                                                                                                                          i_equal     7                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    

   COND       purge all data                                                     - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.008))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     run purge                            WAVE_purge_all                                                                                                                    i_equal     0                                                                                                    
     echo     ... review count                     - - - - - - - - - - - - -   my.scrps                                                                                              i_equal     0                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  4                                                                                   s_equal     WAVE entry  ( 4) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  5                                                                                   s_equal     WAVE entry  ( 5) : -  -   -[]                       -   -[]                                          
     get      ... check entry                      WAVE__unit                  "entry"        ,  6                                                                                   s_equal     WAVE entry  ( 6) : -  -   -[]                       -   -[]                                          

   COND       read database                                                      - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.009))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     exec     call reading                         DB_read                                                                                                                           i_equal     7                                                                                                    
     echo     ... review file pointer              - - - - - - - - - - - - -   my.f_db                                                                                               p_null      0                                                                                                    
     get      ... check entry                      WAVE__unit                  "entry"        ,  0                                                                                   s_equal     WAVE entry  ( 0) : У  2   5[koios]                  2  12[other script]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  1                                                                                   s_equal     WAVE entry  ( 1) : Ж  7  10[koios_scrp]             1   8[good one]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  2                                                                                   s_equal     WAVE entry  ( 2) : Ж  8  10[koios_scrp]             2   9[fantastic]                                 
     get      ... check entry                      WAVE__unit                  "entry"        ,  3                                                                                   s_equal     WAVE entry  ( 3) : в  5   5[koios]                  5  14[another sample]                            
     get      ... check entry                      WAVE__unit                  "entry"        ,  4                                                                                   s_equal     WAVE entry  ( 4) : Ы  2  10[koios_prog]             1   8[middlish]                                  
     get      ... check entry                      WAVE__unit                  "entry"        ,  5                                                                                   s_equal     WAVE entry  ( 5) : ш  1  10[koios_prog]             2  12[little later]                              
     get      ... check entry                      WAVE__unit                  "entry"        ,  6                                                                                   s_equal     WAVE entry  ( 6) :    7   5[koios]                 11  13[sample script]                             

   COND       complete testing                                                   - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -   ((02.010))  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
     code     make sure test file is not there     - - - - - - - - - - - - -   system ("rm -f /tmp/testing.db");                                                                                                                                                                                          
     exec     stop testing                         PROG__unit_end                                                                                                                    i_equal     0                                                                                                    



# end-of-file.  done, finito, completare, whimper [¤┤иии
